
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/logo_tab.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>C#3 6 - SKILBRIDGE</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../styles/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../.." title="SKILBRIDGE" class="md-header__button md-logo" aria-label="SKILBRIDGE" data-md-component="logo">
      
  <img src="../../assets/images/logo_tab.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SKILBRIDGE
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              C#3 6
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SKILBRIDGE" class="md-nav__button md-logo" aria-label="SKILBRIDGE" data-md-component="logo">
      
  <img src="../../assets/images/logo_tab.png" alt="logo">

    </a>
    SKILBRIDGE
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ホーム
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    コース一覧
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    コース一覧
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    01_PC基礎
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    01_PC基礎
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_PC%E5%9F%BA%E7%A4%8E/PCBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_PC%E5%9F%BA%E7%A4%8E/PCBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_PC%E5%9F%BA%E7%A4%8E/PCBasic_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_PC%E5%9F%BA%E7%A4%8E/PCBasic_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_PC%E5%9F%BA%E7%A4%8E/PCBasic_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    02_Web基礎
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    02_Web基礎
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン9
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン10
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_11/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン11
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_12/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン12
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_13/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン13
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_14/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン14
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_15/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン15
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_16/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン16
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_17/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン17
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_18/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン18
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    03_Java入門
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    03_Java入門
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン9
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_Java%E5%85%A5%E9%96%80/JavaBasic_10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン10
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    04_Java基礎固め
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    04_Java基礎固め
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン4
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン5
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン6
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン7
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン8
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン9
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../04_Java%E5%9F%BA%E7%A4%8E%E5%9B%BA%E3%82%81/Java2_10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン10
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    05_OOP基礎
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    05_OOP基礎
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    06_OOP応用
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    06_OOP応用
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    07_Git/GitHub基礎
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    07_Git/GitHub基礎
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    08_SQL・DB設計
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    08_SQL・DB設計
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    09_SpringBoot：表示機能
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    09_SpringBoot：表示機能
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    10_SpringBoot：登録更新機能
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    10_SpringBoot：登録更新機能
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    11_SpringBoot：検索削除機能
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    11_SpringBoot：検索削除機能
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    12_実務基礎
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    12_実務基礎
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    C#初級
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            
  
    C#初級
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14" >
        
          
          <label class="md-nav__link" for="__nav_2_14" id="__nav_2_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    C#中級
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    C#中級
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_15" >
        
          
          <label class="md-nav__link" for="__nav_2_15" id="__nav_2_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    C#上級
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_15">
            <span class="md-nav__icon md-icon"></span>
            
  
    C#上級
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_16" >
        
          
          <label class="md-nav__link" for="__nav_2_16" id="__nav_2_16_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Office全般ツール
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_16">
            <span class="md-nav__icon md-icon"></span>
            
  
    Office全般ツール
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン1
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_Web%E5%9F%BA%E7%A4%8E/WebBasic_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    レッスン2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        学習目標
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    <span class="md-ellipsis">
      
        はじめに - リフレクションとは
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="はじめに - リフレクションとは">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        なぜリフレクションが重要なのか
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        学習内容の概要
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. 型情報の取得と操作
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. 型情報の取得と操作">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        基本的な型情報の取得
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        メンバー情報の詳細探索
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. 動的なオブジェクト作成とメソッド呼び出し
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 動的なオブジェクト作成とメソッド呼び出し">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        効率的な動的オブジェクト生成
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        動的メソッド呼び出しとプロパティ操作
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. 属性を使用したメタプログラミング
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 属性を使用したメタプログラミング">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        カスタム属性の設計と実装
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
        属性を使用したモデルクラスの定義
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
        高度なバリデーションエンジンの実装
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. 実用的な応用例
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. 実用的な応用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
        設定管理システム
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ormobject-relational-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      
        簡易ORM（Object-Relational Mapping）
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. 演習問題
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. 演習問題">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-" class="md-nav__link">
    <span class="md-ellipsis">
      
        演習1: 基礎レベル - 動的プロパティアクセサー
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-" class="md-nav__link">
    <span class="md-ellipsis">
      
        演習2: 中級レベル - 高度なバリデーションシステム
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-" class="md-nav__link">
    <span class="md-ellipsis">
      
        演習3: 上級レベル - 動的プロキシとインターセプター
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-" class="md-nav__link">
    <span class="md-ellipsis">
      
        演習4: 最上級レベル - 式木を使用した高速プロパティアクセサー
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. パフォーマンスとセキュリティの考慮事項
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. パフォーマンスとセキュリティの考慮事項">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      
        パフォーマンス最適化
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      
        セキュリティ考慮事項
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      
        まとめ
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="まとめ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      
        リフレクション活用のベストプラクティス
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リフレクション活用のベストプラクティス">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      
        適切な使用場面
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      
        パフォーマンス最適化戦略
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      
        セキュリティ考慮事項
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      
        設計原則
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      
        次のステップへ
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>C#3 6</h1>

<?xml version="1.0" encoding="UTF-8"?>
<p><lesson>
  <type>text</type>
  <description>C#のリフレクション機能を使用した動的なプログラミング技法を学習します。型情報の取得、動的メソッド呼び出し、属性を使用したメタプログラミングなど、フレームワーク開発で重要となる高度な技術を習得します。</description>
  <title>リフレクションと動的プログラミング</title>
  <content># リフレクションと動的プログラミング</p>
<h2 id="_1">学習目標</h2>
<ul>
<li>リフレクションの基本概念と実用的な活用方法を理解する</li>
<li>属性を使用したメタプログラミングの設計・実装を習得する</li>
<li>動的なオブジェクト操作とパフォーマンス最適化技法を学ぶ</li>
<li>実際の開発で安全かつ効果的にリフレクションを使用できるようになる</li>
<li>フレームワーク開発で必要となる高度な動的プログラミング技法を身につける</li>
</ul>
<h2 id="-">はじめに - リフレクションとは</h2>
<p>リフレクション（Reflection）は、<strong>実行時にプログラム自身の構造を調べ、操作する機能</strong>です。まさに「鏡で自分を見る」ように、プログラムが自分自身の型情報やメンバーを調べることができます。</p>
<h3 id="_2">なぜリフレクションが重要なのか</h3>
<ul>
<li><strong>フレームワーク開発</strong>: ORMやDIコンテナの基盤技術</li>
<li><strong>設定主導開発</strong>: XMLやJSONから動的にオブジェクト生成</li>
<li><strong>汎用的なツール</strong>: シリアライゼーション、バリデーション</li>
<li><strong>デバッグ・診断</strong>: 実行時の状態調査</li>
<li><strong>プラグインアーキテクチャ</strong>: 動的なモジュール読み込み</li>
</ul>
<h3 id="_3">学習内容の概要</h3>
<ol>
<li><strong>型情報の取得と操作</strong> - Type、PropertyInfo、MethodInfoの活用</li>
<li><strong>動的オブジェクト生成</strong> - Activatorと式木による高速化</li>
<li><strong>属性プログラミング</strong> - カスタム属性による宣言的プログラミング</li>
<li><strong>実用的な応用例</strong> - バリデーション、ORM、設定管理</li>
<li><strong>パフォーマンスとセキュリティ</strong> - 最適化技法と注意点</li>
</ol>
<h2 id="1">1. 型情報の取得と操作</h2>
<h3 id="_4">基本的な型情報の取得</h3>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TypeInformationExplorer</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ExploreTypeBasics</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 型情報の取得方法</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">stringType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">);</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">listType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;);</span><span class="w"> </span><span class="c1">// ジェネリック型定義</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">intListType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">int</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;);</span><span class="w"> </span><span class="c1">// 具象化されたジェネリック型</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">===</span><span class="w"> </span><span class="err">基本的な型情報</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">DisplayTypeInfo</span><span class="p">(</span><span class="n">stringType</span><span class="p">);</span>
<span class="w">        </span><span class="n">DisplayTypeInfo</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">));</span>

<span class="w">        </span><span class="c1">// インスタンスから型情報を取得</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Employee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">田中太郎</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">開発部</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">runtimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">GetType</span><span class="p">();</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="err">実行時型</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">runtimeType</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// ジェネリック型の詳細情報</span>
<span class="w">        </span><span class="n">ExploreGenericType</span><span class="p">(</span><span class="n">intListType</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DisplayTypeInfo</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">完全な型名</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">FullName</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">名前空間</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">Namespace</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">基底型</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">BaseType</span><span class="o">?.</span><span class="n">Name</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">なし</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">アセンブリ</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">Assembly</span><span class="p">.</span><span class="n">GetName</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// 型の特性</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">値型</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">IsValueType</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">参照型</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="o">!</span><span class="n">type</span><span class="p">.</span><span class="n">IsValueType</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">クラス</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">IsClass</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">インタ</span><span class="n">ー</span><span class="err">フェ</span><span class="n">ー</span><span class="err">ス</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">IsInterface</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">抽象クラス</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">IsAbstract</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">シ</span><span class="n">ー</span><span class="err">ルドクラス</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">IsSealed</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">ジェネリック</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">IsGenericType</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ExploreGenericType</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">genericType</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">===</span><span class="w"> </span><span class="err">ジェネリック型の詳細</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">genericType</span><span class="p">.</span><span class="n">IsGenericType</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">ジェネリック型定義</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">genericType</span><span class="p">.</span><span class="n">GetGenericTypeDefinition</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">typeArguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">genericType</span><span class="p">.</span><span class="n">GetGenericArguments</span><span class="p">();</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">型引数</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">arg</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">typeArguments</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="p">{</span><span class="n">arg</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// テスト用のクラス</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Employee</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">_id</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">_hireDate</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Employee</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">department</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">().</span><span class="n">ToString</span><span class="p">();</span>
<span class="w">        </span><span class="n">_hireDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
<span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">        </span><span class="n">Department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">department</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Department</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetEmployeeInfo</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">{</span><span class="n">Department</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="n">ID</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">_id</span><span class="p">})</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateSalary</span><span class="p">(</span><span class="kt">decimal</span><span class="w"> </span><span class="n">newSalary</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newSalary</span><span class="p">;</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">Name</span><span class="p">}</span><span class="err">の給与を</span><span class="p">{</span><span class="n">newSalary</span><span class="p">:</span><span class="n">C</span><span class="p">}</span><span class="err">に更新しました</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">InternalMethod</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">これは内部メソッドです</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_5">メンバー情報の詳細探索</h3>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MemberInformationAnalyzer</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AnalyzeClassMembers</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">employeeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">);</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">===</span><span class="w"> </span><span class="err">メンバ</span><span class="n">ー</span><span class="err">情報の詳細分析</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// プロパティ情報の詳細分析</span>
<span class="w">        </span><span class="n">AnalyzeProperties</span><span class="p">(</span><span class="n">employeeType</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// メソッド情報の詳細分析</span>
<span class="w">        </span><span class="n">AnalyzeMethods</span><span class="p">(</span><span class="n">employeeType</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// フィールド情報の分析</span>
<span class="w">        </span><span class="n">AnalyzeFields</span><span class="p">(</span><span class="n">employeeType</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// コンストラクター情報</span>
<span class="w">        </span><span class="n">AnalyzeConstructors</span><span class="p">(</span><span class="n">employeeType</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// イベント情報（もしあれば）</span>
<span class="w">        </span><span class="n">AnalyzeEvents</span><span class="p">(</span><span class="n">employeeType</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AnalyzeProperties</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">プロパティ詳細</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">(</span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">properties</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">プロパティ</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="n">property</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">読み取り</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">property</span><span class="p">.</span><span class="n">CanRead</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">書き込み</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">property</span><span class="p">.</span><span class="n">CanWrite</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">            </span><span class="c1">// getter/setterの詳細</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">property</span><span class="p">.</span><span class="n">CanRead</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">getter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetGetMethod</span><span class="p">();</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="n">Getter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">getter</span><span class="o">?.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="err">仮想</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">getter</span><span class="o">?.</span><span class="n">IsVirtual</span><span class="p">},</span><span class="w"> </span><span class="err">静的</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">getter</span><span class="o">?.</span><span class="n">IsStatic</span><span class="p">})</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">property</span><span class="p">.</span><span class="n">CanWrite</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">setter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetSetMethod</span><span class="p">();</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="n">Setter</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">setter</span><span class="o">?.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="err">仮想</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">setter</span><span class="o">?.</span><span class="n">IsVirtual</span><span class="p">},</span><span class="w"> </span><span class="err">静的</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">setter</span><span class="o">?.</span><span class="n">IsStatic</span><span class="p">})</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="c1">// カスタム属性の確認</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetCustomAttributes</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attributes</span><span class="p">.</span><span class="n">Any</span><span class="p">())</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">属性</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">attr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">attributes</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="p">{</span><span class="n">attr</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AnalyzeMethods</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">---</span><span class="w"> </span><span class="err">メソッド詳細</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetMethods</span><span class="p">(</span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">DeclaredOnly</span><span class="p">);</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">methods</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// プロパティのget/setメソッドはスキップ</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="n">IsSpecialName</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>

<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="n">GetParameters</span><span class="p">();</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">parameterString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span>
<span class="w">                </span><span class="n">parameters</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">p</span><span class="p">.</span><span class="n">ParameterType</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;));</span>

<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">メソッド</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">method</span><span class="p">.</span><span class="n">ReturnType</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="n">method</span><span class="p">.</span><span class="n">Name</span><span class="p">}({</span><span class="n">parameterString</span><span class="p">})</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">仮想</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">method</span><span class="p">.</span><span class="n">IsVirtual</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">静的</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">method</span><span class="p">.</span><span class="n">IsStatic</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">抽象</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">method</span><span class="p">.</span><span class="n">IsAbstract</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">オ</span><span class="n">ー</span><span class="err">バ</span><span class="n">ー</span><span class="err">ライド</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">method</span><span class="p">.</span><span class="n">IsVirtual</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="n">DeclaringType</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="n">GetBaseDefinition</span><span class="p">().</span><span class="n">DeclaringType</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">            </span><span class="c1">// パラメーター詳細</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parameters</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">パラメ</span><span class="n">ー</span><span class="err">タ</span><span class="n">ー</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="p">{</span><span class="n">param</span><span class="p">.</span><span class="n">ParameterType</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="n">param</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="o">+</span>
<span class="w">                                    </span><span class="p">(</span><span class="n">param</span><span class="p">.</span><span class="n">HasDefaultValue</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">param</span><span class="p">.</span><span class="n">DefaultValue</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;));</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AnalyzeFields</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">---</span><span class="w"> </span><span class="err">フィ</span><span class="n">ー</span><span class="err">ルド詳細</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetFields</span><span class="p">(</span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">fields</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">フィ</span><span class="n">ー</span><span class="err">ルド</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">field</span><span class="p">.</span><span class="n">FieldType</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="n">field</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">アクセス修飾子</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">GetAccessModifier</span><span class="p">(</span><span class="n">field</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">読み取り専用</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">field</span><span class="p">.</span><span class="n">IsInitOnly</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">リテラル</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">field</span><span class="p">.</span><span class="n">IsLiteral</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">静的</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">field</span><span class="p">.</span><span class="n">IsStatic</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AnalyzeConstructors</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">---</span><span class="w"> </span><span class="err">コンストラクタ</span><span class="n">ー</span><span class="err">詳細</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">constructors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetConstructors</span><span class="p">();</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">constructors</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">constructor</span><span class="p">.</span><span class="n">GetParameters</span><span class="p">();</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">parameterString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span>
<span class="w">                </span><span class="n">parameters</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">p</span><span class="p">.</span><span class="n">ParameterType</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;));</span>

<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">コンストラクタ</span><span class="n">ー</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">constructor</span><span class="p">.</span><span class="n">Name</span><span class="p">}({</span><span class="n">parameterString</span><span class="p">})</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">アクセス修飾子</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">GetAccessModifier</span><span class="p">(</span><span class="n">constructor</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AnalyzeEvents</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetEvents</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">events</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">---</span><span class="w"> </span><span class="err">イベント</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">eventInfo</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">events</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">イベント</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">eventInfo</span><span class="p">.</span><span class="n">EventHandlerType</span><span class="o">?.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="n">eventInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetAccessModifier</span><span class="p">(</span><span class="n">FieldInfo</span><span class="w"> </span><span class="n">field</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">IsPublic</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">public</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">IsPrivate</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">private</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">IsFamily</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">protected</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">IsAssembly</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">internal</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">IsFamilyOrAssembly</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">protected</span><span class="w"> </span><span class="k">internal</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">unknown</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetAccessModifier</span><span class="p">(</span><span class="n">ConstructorInfo</span><span class="w"> </span><span class="n">constructor</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">constructor</span><span class="p">.</span><span class="n">IsPublic</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">public</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">constructor</span><span class="p">.</span><span class="n">IsPrivate</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">private</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">constructor</span><span class="p">.</span><span class="n">IsFamily</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">protected</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">constructor</span><span class="p">.</span><span class="n">IsAssembly</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">internal</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">unknown</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="2">2. 動的なオブジェクト作成とメソッド呼び出し</h2>
<h3 id="_6">効率的な動的オブジェクト生成</h3>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Linq.Expressions</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Reflection</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Concurrent</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DynamicObjectFactory</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// パフォーマンス向上のためのキャッシュ</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">object</span><span class="p">[],</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_constructorCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_parameterlessCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DemonstrateDynamicCreation</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">===</span><span class="w"> </span><span class="err">動的オブジェクト作成のデモンストレ</span><span class="n">ー</span><span class="err">ション</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// 方法1: Activator.CreateInstance（簡単だが低速）</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n1</span><span class="p">.</span><span class="w"> </span><span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">CreateWithActivator</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 方法2: コンパイル済み式（高速）</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n2</span><span class="p">.</span><span class="w"> </span><span class="err">コンパイル済み式</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">CreateWithCompiledExpression</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 方法3: ジェネリック制約の活用</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n3</span><span class="p">.</span><span class="w"> </span><span class="err">ジェネリック制約</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">CreateWithGenericConstraint</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 方法4: FormatterServices（特殊用途）</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n4</span><span class="p">.</span><span class="w"> </span><span class="n">FormatterServices</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">CreateWithFormatterServices</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateWithActivator</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">employeeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// パラメーターなしコンストラクター（存在しない場合はエラー）</span>
<span class="w">        </span><span class="k">try</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">emp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="p">(</span><span class="n">employeeType</span><span class="p">);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">作成失敗予定</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">emp1</span><span class="o">?.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Expected</span><span class="w"> </span><span class="n">error</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// パラメーター付きコンストラクター</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">emp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="p">(</span><span class="n">employeeType</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">田中太郎</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">開発部</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">作成成功</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">emp2</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">{</span><span class="n">emp2</span><span class="p">.</span><span class="n">Department</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// ジェネリック版（型制約がある場合のみ使用可能）</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">stringInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Hello</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;.</span><span class="n">ToCharArray</span><span class="p">());</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">String</span><span class="err">作成</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">stringInstance</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateWithCompiledExpression</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// より高速な方法：コンパイル済み式</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">).</span><span class="n">GetConstructor</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">createFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetOrCreateConstructorFunction</span><span class="p">(</span><span class="n">constructor</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="n">createFunc</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">佐藤花子</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">営業部</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">高速作成</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">emp</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">{</span><span class="n">emp</span><span class="p">.</span><span class="n">Department</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// パフォーマンステスト</span>
<span class="w">        </span><span class="n">PerformanceComparison</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateWithGenericConstraint</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ジェネリック制約 where T : new() を使用</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateGenericInstance</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">        </span><span class="n">list</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テスト</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Generic</span><span class="w"> </span><span class="n">List</span><span class="err">作成</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">list</span><span class="p">.</span><span class="n">Count</span><span class="p">}</span><span class="err">個の要素</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">dict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateGenericInstance</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">        </span><span class="n">dict</span><span class="p">[</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">key</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Generic</span><span class="w"> </span><span class="n">Dictionary</span><span class="err">作成</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">dict</span><span class="p">.</span><span class="n">Count</span><span class="p">}</span><span class="err">個の要素</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateWithFormatterServices</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 注意：コンストラクターを呼ばずにインスタンス作成（特殊用途）</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">uninitializedEmployee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Serialization</span><span class="p">.</span><span class="n">FormatterServices</span>
<span class="w">            </span><span class="p">.</span><span class="n">GetUninitializedObject</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">));</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">未初期化オブジェクト</span><span class="p">:</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="p">{</span><span class="n">uninitializedEmployee</span><span class="p">.</span><span class="n">Name</span><span class="p">},</span><span class="w"> </span><span class="n">Dept</span><span class="o">=</span><span class="p">{</span><span class="n">uninitializedEmployee</span><span class="p">.</span><span class="n">Department</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// プロパティを手動で設定</span>
<span class="w">        </span><span class="n">uninitializedEmployee</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">手動設定</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="n">uninitializedEmployee</span><span class="p">.</span><span class="n">Department</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">特殊部門</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">手動設定後</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">uninitializedEmployee</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">{</span><span class="n">uninitializedEmployee</span><span class="p">.</span><span class="n">Department</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 汎用的なコンストラクター関数の生成とキャッシュ</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">object</span><span class="p">[],</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetOrCreateConstructorFunction</span><span class="p">(</span><span class="n">ConstructorInfo</span><span class="w"> </span><span class="n">constructor</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">constructor</span><span class="p">.</span><span class="n">DeclaringType</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_constructorCache</span><span class="p">.</span><span class="n">GetOrAdd</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">parametersParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Parameter</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="kt">object</span><span class="p">[]),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">parameters</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">parameterTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">constructor</span><span class="p">.</span><span class="n">GetParameters</span><span class="p">();</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">argumentExpressions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Expression</span><span class="p">[</span><span class="n">parameterTypes</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>

<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">parameterTypes</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">parameterType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parameterTypes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ParameterType</span><span class="p">;</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">arrayAccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">ArrayIndex</span><span class="p">(</span><span class="n">parametersParam</span><span class="p">,</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">                </span><span class="n">argumentExpressions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Convert</span><span class="p">(</span><span class="n">arrayAccess</span><span class="p">,</span><span class="w"> </span><span class="n">parameterType</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">newExpression</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">New</span><span class="p">(</span><span class="n">constructor</span><span class="p">,</span><span class="w"> </span><span class="n">argumentExpressions</span><span class="p">);</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Lambda</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">object</span><span class="p">[],</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">newExpression</span><span class="p">,</span><span class="w"> </span><span class="n">parametersParam</span><span class="p">);</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">lambda</span><span class="p">.</span><span class="n">Compile</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ジェネリック制約を使用した型安全な作成</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">CreateGenericInstance</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">T</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">PerformanceComparison</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100000</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="n">Stopwatch</span><span class="p">.</span><span class="n">StartNew</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Activator.CreateInstance</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">iterations</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Test</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Dept</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Activator</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">}</span><span class="n">ms</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// Compiled Expression</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">).</span><span class="n">GetConstructor</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">compiledFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetOrCreateConstructorFunction</span><span class="p">(</span><span class="n">constructor</span><span class="p">);</span>

<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">iterations</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">emp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Employee</span><span class="p">)</span><span class="n">compiledFunc</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Test</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Dept</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Compiled</span><span class="w"> </span><span class="n">Expression</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">}</span><span class="n">ms</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_7">動的メソッド呼び出しとプロパティ操作</h3>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DynamicMethodInvoker</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// メソッド呼び出しのキャッシュ</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">MethodInfo</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_methodCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">PropertyInfo</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_propertyCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DemonstrateDynamicInvocation</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Employee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">山田次郎</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">技術部</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">employee</span><span class="p">.</span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<span class="w">        </span><span class="n">employee</span><span class="p">.</span><span class="n">Salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500000</span><span class="p">;</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">===</span><span class="w"> </span><span class="err">動的メソッド呼び出しのデモンストレ</span><span class="n">ー</span><span class="err">ション</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// プロパティの動的操作</span>
<span class="w">        </span><span class="n">DynamicPropertyOperations</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// メソッドの動的呼び出し</span>
<span class="w">        </span><span class="n">DynamicMethodCalls</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// プライベートメンバーのアクセス</span>
<span class="w">        </span><span class="n">AccessPrivateMembers</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// パフォーマンス最適化版</span>
<span class="w">        </span><span class="n">OptimizedDynamicAccess</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DynamicPropertyOperations</span><span class="p">(</span><span class="n">Employee</span><span class="w"> </span><span class="n">employee</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">プロパティの動的操作</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">employeeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// プロパティ値の取得</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">nameProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPropertyInfo</span><span class="p">(</span><span class="n">employeeType</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Name</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">ageProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPropertyInfo</span><span class="p">(</span><span class="n">employeeType</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Age</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">salaryProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPropertyInfo</span><span class="p">(</span><span class="n">employeeType</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Salary</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">現在の値</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">nameProperty</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="n">Age</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">ageProperty</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="n">Salary</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">salaryProperty</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">):</span><span class="n">C</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// プロパティ値の設定</span>
<span class="w">        </span><span class="n">nameProperty</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">更新された名前</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">ageProperty</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">);</span>
<span class="w">        </span><span class="n">salaryProperty</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="mi">600000</span><span class="p">);</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="err">更新後の値</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">employee</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="n">Age</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">employee</span><span class="p">.</span><span class="n">Age</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="n">Salary</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">employee</span><span class="p">.</span><span class="n">Salary</span><span class="p">:</span><span class="n">C</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// 型変換を伴う設定</span>
<span class="w">        </span><span class="n">TrySetPropertyValue</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Age</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="mi">40</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span><span class="w"> </span><span class="c1">// 文字列から数値への変換</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">型変換後の</span><span class="n">Age</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">employee</span><span class="p">.</span><span class="n">Age</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DynamicMethodCalls</span><span class="p">(</span><span class="n">Employee</span><span class="w"> </span><span class="n">employee</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">メソッドの動的呼び出し</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">employeeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// パラメーターなしメソッド</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">getInfoMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetMethodInfo</span><span class="p">(</span><span class="n">employeeType</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">GetEmployeeInfo</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">getInfoMethod</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Employee</span><span class="w"> </span><span class="n">Info</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">info</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// パラメーター付きメソッド</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">updateSalaryMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetMethodInfo</span><span class="p">(</span><span class="n">employeeType</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">UpdateSalary</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">updateSalaryMethod</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">700000m</span><span class="w"> </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// オーバーロードされたメソッドの呼び出し</span>
<span class="w">        </span><span class="n">InvokeOverloadedMethod</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AccessPrivateMembers</span><span class="p">(</span><span class="n">Employee</span><span class="w"> </span><span class="n">employee</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">プライベ</span><span class="n">ー</span><span class="err">トメンバ</span><span class="n">ー</span><span class="err">のアクセス</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Type</span><span class="w"> </span><span class="n">employeeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// プライベートフィールドのアクセス</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">idField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employeeType</span><span class="p">.</span><span class="n">GetField</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">_id</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">hireDateField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employeeType</span><span class="p">.</span><span class="n">GetField</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">_hireDate</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">idField</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">idField</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">プライベ</span><span class="n">ー</span><span class="err">ト</span><span class="n">ID</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">id</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hireDateField</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">hireDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">)</span><span class="n">hireDateField</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">雇用日</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">hireDate</span><span class="p">:</span><span class="n">yyyy</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">dd</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// プライベートメソッドの呼び出し</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">internalMethod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employeeType</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">InternalMethod</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span>
<span class="w">            </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span><span class="p">);</span>
<span class="w">        </span><span class="n">internalMethod</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OptimizedDynamicAccess</span><span class="p">(</span><span class="n">Employee</span><span class="w"> </span><span class="n">employee</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">最適化された動的アクセス</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// デリゲート化による高速化</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">nameProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPropertyInfo</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Name</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">nameGetter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePropertyGetter</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Employee</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">nameProperty</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">nameSetter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePropertySetter</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Employee</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">nameProperty</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 高速アクセス</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">currentName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nameGetter</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">高速取得</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">currentName</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="n">nameSetter</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">高速設定された名前</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">高速設定後</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">employee</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ヘルパーメソッド</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">PropertyInfo</span><span class="w"> </span><span class="nf">GetPropertyInfo</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">type</span><span class="p">.</span><span class="n">FullName</span><span class="p">}.{</span><span class="n">propertyName</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_propertyCache</span><span class="p">.</span><span class="n">GetOrAdd</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">propertyName</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">MethodInfo</span><span class="w"> </span><span class="nf">GetMethodInfo</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">methodName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">type</span><span class="p">.</span><span class="n">FullName</span><span class="p">}.{</span><span class="n">methodName</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_methodCache</span><span class="p">.</span><span class="n">GetOrAdd</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">(</span><span class="n">methodName</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TrySetPropertyValue</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPropertyInfo</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">GetType</span><span class="p">(),</span><span class="w"> </span><span class="n">propertyName</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">property</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">CanWrite</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">convertedValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Convert</span><span class="p">.</span><span class="n">ChangeType</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span><span class="p">);</span>
<span class="w">                </span><span class="n">property</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">convertedValue</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">プロパティ設定エラ</span><span class="n">ー</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">InvokeOverloadedMethod</span><span class="p">(</span><span class="n">Employee</span><span class="w"> </span><span class="n">employee</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// オーバーロードを考慮したメソッド取得</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetMethods</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">UpdateSalary</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)</span>
<span class="w">            </span><span class="p">.</span><span class="n">ToArray</span><span class="p">();</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">UpdateSalary</span><span class="err">のオ</span><span class="n">ー</span><span class="err">バ</span><span class="n">ー</span><span class="err">ロ</span><span class="n">ー</span><span class="err">ド数</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">methods</span><span class="p">.</span><span class="n">Length</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">methods</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="n">GetParameters</span><span class="p">();</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">paramTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">parameters</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ParameterType</span><span class="p">.</span><span class="n">Name</span><span class="p">));</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="err">オ</span><span class="n">ー</span><span class="err">バ</span><span class="n">ー</span><span class="err">ロ</span><span class="n">ー</span><span class="err">ド</span><span class="p">:</span><span class="w"> </span><span class="n">UpdateSalary</span><span class="p">({</span><span class="n">paramTypes</span><span class="p">})</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// プロパティアクセサーのデリゲート生成</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">CreatePropertyGetter</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">PropertyInfo</span><span class="w"> </span><span class="n">property</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">objParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Parameter</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">obj</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">propertyAccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Property</span><span class="p">(</span><span class="n">objParam</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Lambda</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">propertyAccess</span><span class="p">,</span><span class="w"> </span><span class="n">objParam</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lambda</span><span class="p">.</span><span class="n">Compile</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Action</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">CreatePropertySetter</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">PropertyInfo</span><span class="w"> </span><span class="n">property</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">objParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Parameter</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">obj</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">valueParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Parameter</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">TProperty</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="k">value</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">propertyAccess</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Property</span><span class="p">(</span><span class="n">objParam</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">assignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Assign</span><span class="p">(</span><span class="n">propertyAccess</span><span class="p">,</span><span class="w"> </span><span class="n">valueParam</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Lambda</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Action</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">assignment</span><span class="p">,</span><span class="w"> </span><span class="n">objParam</span><span class="p">,</span><span class="w"> </span><span class="n">valueParam</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lambda</span><span class="p">.</span><span class="n">Compile</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="3">3. 属性を使用したメタプログラミング</h2>
<h3 id="_8">カスタム属性の設計と実装</h3>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.ComponentModel</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">System.Linq</span><span class="p">;</span>

<span class="c1">// 基本的なバリデーション属性</span>
<span class="na">[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ValidationAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Attribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsRequired</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">ValidationAttribute</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="nf">Validate</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ValidationResult</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsRequired</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrWhiteSpace</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ToString</span><span class="p">())))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="n">AddError</span><span class="p">(</span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">propertyName</span><span class="p">}</span><span class="err">は必須です</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 範囲チェック属性</span>
<span class="na">[AttributeUsage(AttributeTargets.Property)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">RangeAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValidationAttribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">MinValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">MaxValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">RangeAttribute</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">minValue</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">maxValue</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">MinValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minValue</span><span class="p">;</span>
<span class="w">        </span><span class="n">MaxValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxValue</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="nf">Validate</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">base</span><span class="p">.</span><span class="n">Validate</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">propertyName</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">HasErrors</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TryConvertToDouble</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">numericValue</span><span class="p">))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">numericValue</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">MinValue</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">numericValue</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">MaxValue</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">result</span><span class="p">.</span><span class="n">AddError</span><span class="p">(</span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span>
<span class="w">                        </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">propertyName</span><span class="p">}</span><span class="err">は</span><span class="p">{</span><span class="n">MinValue</span><span class="p">}</span><span class="err">から</span><span class="p">{</span><span class="n">MaxValue</span><span class="p">}</span><span class="err">の範囲で入力してください</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryConvertToDouble</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">result</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kt">double</span><span class="p">.</span><span class="n">TryParse</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 文字列長制限属性</span>
<span class="na">[AttributeUsage(AttributeTargets.Property)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">StringLengthAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValidationAttribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxLength</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MinLength</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">StringLengthAttribute</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">maxLength</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">MaxLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxLength</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="nf">Validate</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">base</span><span class="p">.</span><span class="n">Validate</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">propertyName</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">stringValue</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">HasErrors</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stringValue</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">MinLength</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">stringValue</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">MaxLength</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">AddError</span><span class="p">(</span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">propertyName</span><span class="p">}</span><span class="err">は</span><span class="p">{</span><span class="n">MinLength</span><span class="p">}</span><span class="err">文字以上</span><span class="p">{</span><span class="n">MaxLength</span><span class="p">}</span><span class="err">文字以下で入力してください</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 正規表現パターン属性</span>
<span class="na">[AttributeUsage(AttributeTargets.Property)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">RegexPatternAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValidationAttribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Pattern</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">RegexPatternAttribute</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">pattern</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pattern</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="nf">Validate</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">base</span><span class="p">.</span><span class="n">Validate</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">propertyName</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">stringValue</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">HasErrors</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">stringValue</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">RegularExpressions</span><span class="p">.</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="p">(</span><span class="n">stringValue</span><span class="p">,</span><span class="w"> </span><span class="n">Pattern</span><span class="p">))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">AddError</span><span class="p">(</span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">propertyName</span><span class="p">}</span><span class="err">の形式が正しくありません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// カスタムバリデーション属性（デリゲートベース）</span>
<span class="na">[AttributeUsage(AttributeTargets.Property)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomValidationAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValidationAttribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">ValidatorType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">MethodName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">CustomValidationAttribute</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">validatorType</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">methodName</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span>
<span class="w">        </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">ValidatorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validatorType</span><span class="p">;</span>
<span class="w">        </span><span class="n">MethodName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">methodName</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="nf">Validate</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">base</span><span class="p">.</span><span class="n">Validate</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">propertyName</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="n">HasErrors</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ValidatorType</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">(</span><span class="n">MethodName</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Public</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BindingFlags</span><span class="p">.</span><span class="n">Static</span><span class="p">);</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="kt">var</span><span class="w"> </span><span class="n">isValid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="n">method</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="p">});</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isValid</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="n">result</span><span class="p">.</span><span class="n">AddError</span><span class="p">(</span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span>
<span class="w">                            </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">propertyName</span><span class="p">}</span><span class="err">のバリデ</span><span class="n">ー</span><span class="err">ションに失敗しました</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">AddError</span><span class="p">(</span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">バリデ</span><span class="n">ー</span><span class="err">ションエラ</span><span class="n">ー</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_9">属性を使用したモデルクラスの定義</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 属性でデコレートされたモデルクラス</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomerRegistration</span>
<span class="p">{</span>
<span class="w">    </span><span class="na">[Validation(IsRequired = true, Order = 1)]</span>
<span class="w">    </span><span class="na">[StringLength(50, MinLength = 2, ErrorMessage = &amp;quot;名前は2文字以上50文字以下で入力してください&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Validation(IsRequired = true, Order = 2)]</span>
<span class="w">    </span><span class="na">[RegexPattern(@&amp;quot;^[a-zA-Z0-9._%+-]</span><span class="o">+</span><span class="err">@</span><span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z0</span><span class="o">-</span><span class="mi">9</span><span class="p">.</span><span class="o">-</span><span class="p">]</span><span class="o">+</span><span class="err">\</span><span class="p">.[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z</span><span class="p">]{</span><span class="mi">2</span><span class="p">,}</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span>
<span class="w">                 </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">正しいメ</span><span class="n">ー</span><span class="err">ルアドレス形式で入力してください</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Email</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Range(0, 150, Order = 3)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[StringLength(15, MinLength = 10, ErrorMessage = &amp;quot;電話番号は10桁以上15桁以下で入力してください&amp;quot;)]</span>
<span class="w">    </span><span class="na">[RegexPattern(@&amp;quot;^[\d-+()]</span><span class="o">+</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">ErrorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">電話番号は数字、ハイフン、括弧のみ使用可能です</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">PhoneNumber</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Range(0, double.MaxValue, ErrorMessage = &amp;quot;年収は0以上で入力してください&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">AnnualIncome</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[CustomValidation(typeof(CustomValidators), nameof(CustomValidators.ValidatePassword), </span>
<span class="na">                     ErrorMessage = &amp;quot;パスワードは8文字以上で、大文字・小文字・数字を含む必要があります&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Password</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[StringLength(500)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Notes</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// カスタムバリデーター</span>
<span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomValidators</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ValidatePassword</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">password</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>

<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasUpper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="kt">char</span><span class="p">.</span><span class="n">IsUpper</span><span class="p">);</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasLower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="kt">char</span><span class="p">.</span><span class="n">IsLower</span><span class="p">);</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasDigit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="kt">char</span><span class="p">.</span><span class="n">IsDigit</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">hasUpper</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">hasLower</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">hasDigit</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_10">高度なバリデーションエンジンの実装</h3>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AdvancedValidator</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">PropertyValidationInfo</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_validationCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="nf">ValidateObject</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">obj</span><span class="p">));</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ValidationResult</span><span class="p">();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="n">GetType</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// バリデーション情報をキャッシュから取得または生成</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">validationInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetValidationInfo</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 順序付きでバリデーションを実行</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">validationInfos</span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">Order</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ValidateProperty</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">PropertyValidationInfo</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetValidationInfo</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_validationCache</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">cachedInfo</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">cachedInfo</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">validationInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">PropertyValidationInfo</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">validationAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetCustomAttributes</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ValidationAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;().</span><span class="n">ToList</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validationAttributes</span><span class="p">.</span><span class="n">Any</span><span class="p">())</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">validationInfos</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PropertyValidationInfo</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">,</span>
<span class="w">                    </span><span class="n">ValidationAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validationAttributes</span><span class="p">,</span>
<span class="w">                    </span><span class="n">Order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validationAttributes</span><span class="p">.</span><span class="n">Min</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Order</span><span class="p">)</span>
<span class="w">                </span><span class="p">});</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">_validationCache</span><span class="p">[</span><span class="n">type</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validationInfos</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">validationInfos</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ValidateProperty</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">PropertyValidationInfo</span><span class="w"> </span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="n">result</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">Property</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">ValidationAttributes</span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Order</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">validationResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">attribute</span><span class="p">.</span><span class="n">Validate</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">Property</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="w">            </span><span class="n">result</span><span class="p">.</span><span class="n">Merge</span><span class="p">(</span><span class="n">validationResult</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// 必須チェックでエラーがあった場合、他のバリデーションはスキップ</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">attribute</span><span class="p">.</span><span class="n">IsRequired</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">validationResult</span><span class="p">.</span><span class="n">HasErrors</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 条件付きバリデーション</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="nf">ValidateObjectConditional</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">PropertyInfo</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">propertyFilter</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">obj</span><span class="p">));</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ValidationResult</span><span class="p">();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="n">GetType</span><span class="p">();</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">validationInfos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetValidationInfo</span><span class="p">(</span><span class="n">type</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">info</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">propertyFilter</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">Property</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">Order</span><span class="p">);</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">validationInfos</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">ValidateProperty</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 差分バリデーション（変更されたプロパティのみ）</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">ValidationResult</span><span class="w"> </span><span class="nf">ValidateChanges</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">original</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">modified</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">original</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">modified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">ArgumentNullException</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">original</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">modified</span><span class="p">.</span><span class="n">GetType</span><span class="p">())</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">ArgumentException</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">オブジェクトの型が一致しません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">ValidateObjectConditional</span><span class="p">(</span><span class="n">modified</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">originalValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">original</span><span class="p">);</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">modifiedValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">modified</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">Equals</span><span class="p">(</span><span class="n">originalValue</span><span class="p">,</span><span class="w"> </span><span class="n">modifiedValue</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PropertyValidationInfo</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">PropertyInfo</span><span class="w"> </span><span class="n">Property</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ValidationAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">ValidationAttributes</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ValidationResult</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsValid</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_errors</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">HasErrors</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">IsValid</span><span class="p">;</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">IReadOnlyDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">Errors</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_errors</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddError</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">errorMessage</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_errors</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">propertyName</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">_errors</span><span class="p">[</span><span class="n">propertyName</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">_errors</span><span class="p">[</span><span class="n">propertyName</span><span class="p">].</span><span class="n">Add</span><span class="p">(</span><span class="n">errorMessage</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Merge</span><span class="p">(</span><span class="n">ValidationResult</span><span class="w"> </span><span class="n">other</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">kvp</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">_errors</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">AddError</span><span class="p">(</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetErrorSummary</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsValid</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">バリデ</span><span class="n">ー</span><span class="err">ション成功</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">allErrors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_errors</span><span class="p">.</span><span class="n">SelectMany</span><span class="p">(</span><span class="n">kvp</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="n">kvp</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">•</span><span class="w"> </span><span class="p">{</span><span class="n">kvp</span><span class="p">.</span><span class="n">Key</span><span class="p">}:</span><span class="w"> </span><span class="p">{</span><span class="n">error</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;));</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">バリデ</span><span class="n">ー</span><span class="err">ションエラ</span><span class="n">ー</span><span class="p">:</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">allErrors</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetErrorsForProperty</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_errors</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">errors</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="4">4. 実用的な応用例</h2>
<h3 id="_11">設定管理システム</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// 設定項目を属性で定義</span>
<span class="na">[AttributeUsage(AttributeTargets.Property)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ConfigurationAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Attribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Key</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">DefaultValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Description</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsRequired</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Section</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">General</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">ConfigurationAttribute</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">key</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 設定クラス</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ApplicationSettings</span>
<span class="p">{</span>
<span class="w">    </span><span class="na">[Configuration(&amp;quot;database.connectionString&amp;quot;, IsRequired = true, </span>
<span class="na">                   Description = &amp;quot;データベース接続文字列&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">DatabaseConnectionString</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Configuration(&amp;quot;api.timeout&amp;quot;, DefaultValue = 30, </span>
<span class="na">                   Description = &amp;quot;API タイムアウト時間（秒）&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ApiTimeout</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Configuration(&amp;quot;logging.level&amp;quot;, DefaultValue = &amp;quot;Info&amp;quot;, Section = &amp;quot;Logging&amp;quot;,</span>
<span class="na">                   Description = &amp;quot;ログレベル&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">LogLevel</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Configuration(&amp;quot;cache.expirationMinutes&amp;quot;, DefaultValue = 60, Section = &amp;quot;Cache&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">CacheExpirationMinutes</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Configuration(&amp;quot;features.enableNewUI&amp;quot;, DefaultValue = false, Section = &amp;quot;Features&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">EnableNewUI</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 設定管理システム</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ConfigurationManager</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_configurationData</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">ConfigurationManager</span><span class="p">(</span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">configurationData</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_configurationData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configurationData</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">LoadConfiguration</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">T</span><span class="p">();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">configAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ConfigurationAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">configAttr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">LoadPropertyValue</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="p">,</span><span class="w"> </span><span class="n">configAttr</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LoadPropertyValue</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">PropertyInfo</span><span class="w"> </span><span class="n">property</span><span class="p">,</span><span class="w"> </span><span class="n">ConfigurationAttribute</span><span class="w"> </span><span class="n">configAttr</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configAttr</span><span class="p">.</span><span class="n">Key</span><span class="p">;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_configurationData</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">configValue</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">convertedValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertValue</span><span class="p">(</span><span class="n">configValue</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span><span class="p">);</span>
<span class="w">                </span><span class="n">property</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">convertedValue</span><span class="p">);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">設定読み込み</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">convertedValue</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">設定変換エラ</span><span class="n">ー</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="p">}:</span><span class="w"> </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="n">SetDefaultValue</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="p">,</span><span class="w"> </span><span class="n">configAttr</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">configAttr</span><span class="p">.</span><span class="n">IsRequired</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">必須設定項目が見つかりません</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">key</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">SetDefaultValue</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="p">,</span><span class="w"> </span><span class="n">configAttr</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetDefaultValue</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">PropertyInfo</span><span class="w"> </span><span class="n">property</span><span class="p">,</span><span class="w"> </span><span class="n">ConfigurationAttribute</span><span class="w"> </span><span class="n">configAttr</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">configAttr</span><span class="p">.</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">convertedDefault</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConvertValue</span><span class="p">(</span><span class="n">configAttr</span><span class="p">.</span><span class="n">DefaultValue</span><span class="p">,</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span><span class="p">);</span>
<span class="w">                </span><span class="n">property</span><span class="p">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">convertedDefault</span><span class="p">);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">デフォルト値設定</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">configAttr</span><span class="p">.</span><span class="n">Key</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">convertedDefault</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">デフォルト値設定エラ</span><span class="n">ー</span><span class="w"> </span><span class="p">{</span><span class="n">configAttr</span><span class="p">.</span><span class="n">Key</span><span class="p">}:</span><span class="w"> </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="nf">ConvertValue</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">targetType</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">targetType</span><span class="p">.</span><span class="n">IsAssignableFrom</span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">GetType</span><span class="p">()))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Nullable型の処理</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">targetType</span><span class="p">.</span><span class="n">IsGenericType</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">targetType</span><span class="p">.</span><span class="n">GetGenericTypeDefinition</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Nullable</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">underlyingType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nullable</span><span class="p">.</span><span class="n">GetUnderlyingType</span><span class="p">(</span><span class="n">targetType</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nf">ConvertValue</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">underlyingType</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Enum型の処理</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">targetType</span><span class="p">.</span><span class="n">IsEnum</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Enum</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">targetType</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 基本的な型変換</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Convert</span><span class="p">.</span><span class="n">ChangeType</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="w"> </span><span class="n">targetType</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">GenerateDocumentation</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">===</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="err">設定ドキュメント</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">propertiesBySection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ConfigurationAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">GroupBy</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ConfigurationAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;().</span><span class="n">Section</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">g</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">Key</span><span class="p">);</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">propertiesBySection</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="p">[{</span><span class="n">section</span><span class="p">.</span><span class="n">Key</span><span class="p">}]</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">section</span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">configAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ConfigurationAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="p">{</span><span class="n">configAttr</span><span class="p">.</span><span class="n">Key</span><span class="p">}:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">型</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">必須</span><span class="p">:</span><span class="w"> </span><span class="p">{(</span><span class="n">configAttr</span><span class="p">.</span><span class="n">IsRequired</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">はい</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">いいえ</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">configAttr</span><span class="p">.</span><span class="n">DefaultValue</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">デフォルト値</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">configAttr</span><span class="p">.</span><span class="n">DefaultValue</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">configAttr</span><span class="p">.</span><span class="n">Description</span><span class="p">))</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">説明</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">configAttr</span><span class="p">.</span><span class="n">Description</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="p">}</span>

<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="ormobject-relational-mapping">簡易ORM（Object-Relational Mapping）</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// テーブルマッピング属性</span>
<span class="na">[AttributeUsage(AttributeTargets.Class)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TableAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Attribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Schema</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">dbo</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">TableAttribute</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// カラムマッピング属性</span>
<span class="na">[AttributeUsage(AttributeTargets.Property)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ColumnAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Attribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsPrimaryKey</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsIdentity</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsRequired</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MaxLength</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">DataType</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">ColumnAttribute</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// エンティティクラスの例</span>
<span class="na">[Table(&amp;quot;Employees&amp;quot;)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Employee</span>
<span class="p">{</span>
<span class="w">    </span><span class="na">[Column(&amp;quot;Id&amp;quot;, IsPrimaryKey = true, IsIdentity = true)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Column(&amp;quot;Name&amp;quot;, IsRequired = true, MaxLength = 100)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Column(&amp;quot;Email&amp;quot;, IsRequired = true, MaxLength = 255)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Email</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Column(&amp;quot;Department&amp;quot;, MaxLength = 50)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Department</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Column(&amp;quot;Salary&amp;quot;, DataType = &amp;quot;decimal(10,2)&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal?</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Column(&amp;quot;HireDate&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">HireDate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 計算プロパティ（DB列にマップされない）</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">YearsOfService</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">Year</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HireDate</span><span class="p">.</span><span class="n">Year</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 簡易ORM実装</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">SimpleORM</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">_connectionString</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">SimpleORM</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">connectionString</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_connectionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connectionString</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">GenerateCreateTableSQL</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tableAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">TableAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tableAttr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="err">に</span><span class="n">Table</span><span class="err">属性が定義されていません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">tableAttr</span><span class="p">.</span><span class="n">Schema</span><span class="p">}.{</span><span class="n">tableAttr</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">columnAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ColumnAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">columnAttr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="kt">var</span><span class="w"> </span><span class="n">columnDefinition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GenerateColumnDefinition</span><span class="p">(</span><span class="n">property</span><span class="p">,</span><span class="w"> </span><span class="n">columnAttr</span><span class="p">);</span>
<span class="w">                </span><span class="n">columns</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">columnDefinition</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">CREATE</span><span class="w"> </span><span class="n">TABLE</span><span class="w"> </span><span class="p">{</span><span class="n">tableName</span><span class="p">}</span><span class="w"> </span><span class="p">(</span><span class="err">\</span><span class="n">n</span><span class="w">  </span><span class="p">{</span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="err">\</span><span class="n">n</span><span class="w">  </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">columns</span><span class="p">)}</span><span class="err">\</span><span class="n">n</span><span class="p">);</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sql</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GenerateColumnDefinition</span><span class="p">(</span><span class="n">PropertyInfo</span><span class="w"> </span><span class="n">property</span><span class="p">,</span><span class="w"> </span><span class="n">ColumnAttribute</span><span class="w"> </span><span class="n">columnAttr</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">columnName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">columnAttr</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">dataType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">columnAttr</span><span class="p">.</span><span class="n">DataType</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">GetSqlDataType</span><span class="p">(</span><span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">definition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">columnName</span><span class="p">}</span><span class="w"> </span><span class="p">{</span><span class="n">dataType</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">IsIdentity</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">definition</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="n">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">IsPrimaryKey</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">definition</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="n">PRIMARY</span><span class="w"> </span><span class="n">KEY</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">IsRequired</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">definition</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">definition</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetSqlDataType</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">propertyType</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Nullable型の処理</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">propertyType</span><span class="p">.</span><span class="n">IsGenericType</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="n">propertyType</span><span class="p">.</span><span class="n">GetGenericTypeDefinition</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Nullable</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">propertyType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Nullable</span><span class="p">.</span><span class="n">GetUnderlyingType</span><span class="p">(</span><span class="n">propertyType</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">propertyType</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="k">switch</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">nameof</span><span class="p">(</span><span class="n">Int32</span><span class="p">)</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">INT</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="k">nameof</span><span class="p">(</span><span class="n">Int64</span><span class="p">)</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">BIGINT</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="k">nameof</span><span class="p">(</span><span class="n">String</span><span class="p">)</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="k">nameof</span><span class="p">(</span><span class="n">DateTime</span><span class="p">)</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">DATETIME2</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="k">nameof</span><span class="p">(</span><span class="n">Decimal</span><span class="p">)</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">DECIMAL</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="k">nameof</span><span class="p">(</span><span class="n">Boolean</span><span class="p">)</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">BIT</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="k">nameof</span><span class="p">(</span><span class="n">Guid</span><span class="p">)</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">UNIQUEIDENTIFIER</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="n">_</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">NVARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">GenerateSelectSQL</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="kt">object</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tableAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">TableAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">tableAttr</span><span class="p">.</span><span class="n">Schema</span><span class="p">}.{</span><span class="n">tableAttr</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetColumnNames</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">SELECT</span><span class="w"> </span><span class="p">{</span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">columns</span><span class="p">)}</span><span class="w"> </span><span class="n">FROM</span><span class="w"> </span><span class="p">{</span><span class="n">tableName</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">primaryKeyColumn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPrimaryKeyColumn</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
<span class="w">            </span><span class="n">sql</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="n">WHERE</span><span class="w"> </span><span class="p">{</span><span class="n">primaryKeyColumn</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">@Id</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sql</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">GenerateInsertSQL</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tableAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">TableAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">tableAttr</span><span class="p">.</span><span class="n">Schema</span><span class="p">}.{</span><span class="n">tableAttr</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">insertColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">valueParameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">columnAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ColumnAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">columnAttr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">IsIdentity</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">insertColumns</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="w">                </span><span class="n">valueParameters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">@</span><span class="p">{</span><span class="n">property</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">INSERT</span><span class="w"> </span><span class="n">INTO</span><span class="w"> </span><span class="p">{</span><span class="n">tableName</span><span class="p">}</span><span class="w"> </span><span class="p">({</span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">insertColumns</span><span class="p">)})</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="o">+</span>
<span class="w">               </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">VALUES</span><span class="w"> </span><span class="p">({</span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="n">valueParameters</span><span class="p">)})</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetColumnNames</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ColumnAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ColumnAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;().</span><span class="n">Name</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="n">ToList</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetPrimaryKeyColumn</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">primaryKeyProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">FirstOrDefault</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ColumnAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span><span class="o">?.</span><span class="n">IsPrimaryKey</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">primaryKeyProperty</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="err">にプライマリキ</span><span class="n">ー</span><span class="err">が定義されていません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">columnAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">primaryKeyProperty</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ColumnAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">columnAttr</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">primaryKeyProperty</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">GenerateEntityDocumentation</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">tableAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">TableAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">===</span><span class="w"> </span><span class="err">エンティティ</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テ</span><span class="n">ー</span><span class="err">ブル</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">tableAttr</span><span class="o">?.</span><span class="n">Schema</span><span class="p">}.{</span><span class="n">tableAttr</span><span class="o">?.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="err">カラム情報</span><span class="p">:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">())</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">columnAttr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetCustomAttribute</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ColumnAttribute</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">columnAttr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">  </span><span class="p">{</span><span class="n">property</span><span class="p">.</span><span class="n">Name</span><span class="p">}:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">カラム名</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">デ</span><span class="n">ー</span><span class="err">タ型</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">DataType</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="n">GetSqlDataType</span><span class="p">(</span><span class="n">property</span><span class="p">.</span><span class="n">PropertyType</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">プライマリキ</span><span class="n">ー</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">IsPrimaryKey</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">自動採番</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">IsIdentity</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">必須</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">IsRequired</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">MaxLength</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w">    </span><span class="err">最大長</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">columnAttr</span><span class="p">.</span><span class="n">MaxLength</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="5">5. 演習問題</h2>
<h3 id="1-">演習1: 基礎レベル - 動的プロパティアクセサー</h3>
<p><strong>問題</strong>: 以下の機能を持つ <code>PropertyAccessor</code> クラスを実装してください：</p>
<ul>
<li>オブジェクトのプロパティ値を辞書形式で取得する <code>GetProperties</code> メソッド</li>
<li>辞書の値からオブジェクトのプロパティを設定する <code>SetProperties</code> メソッド</li>
<li>プロパティの型情報を取得する <code>GetPropertyTypes</code> メソッド</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PropertyAccessor</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO: 実装してください</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetProperties</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// オブジェクトの全プロパティを辞書で取得</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetProperties</span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">values</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 辞書の値でオブジェクトのプロパティを設定</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetPropertyTypes</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 型のプロパティ名と型情報の辞書を返す</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>テストケース</strong>:
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Employee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テスト太郎</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">開発部</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">Salary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500000</span><span class="w"> </span><span class="p">};</span>

<span class="c1">// プロパティ取得</span>
<span class="kt">var</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertyAccessor</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="c1">// properties[&amp;quot;Name&amp;quot;] == &amp;quot;テスト太郎&amp;quot;</span>
<span class="c1">// properties[&amp;quot;Age&amp;quot;] == 30</span>

<span class="c1">// プロパティ設定</span>
<span class="kt">var</span><span class="w"> </span><span class="n">newValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="p">{</span>
<span class="w">    </span><span class="na">[&amp;quot;Name&amp;quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">更新太郎</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">    </span><span class="na">[&amp;quot;Age&amp;quot;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">35</span>
<span class="p">};</span>
<span class="n">PropertyAccessor</span><span class="p">.</span><span class="n">SetProperties</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="n">newValues</span><span class="p">);</span>
<span class="c1">// employee.Name == &amp;quot;更新太郎&amp;quot;, employee.Age == 35</span>

<span class="c1">// 型情報取得</span>
<span class="kt">var</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PropertyAccessor</span><span class="p">.</span><span class="n">GetPropertyTypes</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">));</span>
<span class="c1">// types[&amp;quot;Name&amp;quot;] == typeof(string)</span>
<span class="c1">// types[&amp;quot;Age&amp;quot;] == typeof(int)</span>
</code></pre></div></p>
<h3 id="2-">演習2: 中級レベル - 高度なバリデーションシステム</h3>
<p><strong>問題</strong>: 以下の機能を持つバリデーション属性とバリデーターを実装してください：</p>
<ul>
<li><code>CompareAttribute</code>: 他のプロパティとの比較バリデーション</li>
<li><code>ConditionalValidationAttribute</code>: 条件付きバリデーション</li>
<li><code>DateRangeAttribute</code>: 日付範囲のバリデーション</li>
<li>グループバリデーション機能</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">// 比較バリデーション属性</span>
<span class="na">[AttributeUsage(AttributeTargets.Property)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CompareAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValidationAttribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">OtherProperty</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">ComparisonType</span><span class="w"> </span><span class="n">Comparison</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// TODO: 実装してください</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">ComparisonType</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Equal</span><span class="p">,</span>
<span class="w">    </span><span class="n">NotEqual</span><span class="p">,</span>
<span class="w">    </span><span class="n">GreaterThan</span><span class="p">,</span>
<span class="w">    </span><span class="n">LessThan</span><span class="p">,</span>
<span class="w">    </span><span class="n">GreaterThanOrEqual</span><span class="p">,</span>
<span class="w">    </span><span class="n">LessThanOrEqual</span>
<span class="p">}</span>

<span class="c1">// 条件付きバリデーション属性</span>
<span class="na">[AttributeUsage(AttributeTargets.Property)]</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ConditionalValidationAttribute</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ValidationAttribute</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">PropertyName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">ExpectedValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// TODO: 実装してください</span>
<span class="p">}</span>

<span class="c1">// 使用例のモデル</span>
<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">RegistrationModel</span>
<span class="p">{</span>
<span class="w">    </span><span class="na">[Validation(IsRequired = true)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Password</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[Compare(nameof(Password), ComparisonType.Equal, ErrorMessage = &amp;quot;パスワードが一致しません&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">ConfirmPassword</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[ConditionalValidation(&amp;quot;IsMinor&amp;quot;, false, IsRequired = true, </span>
<span class="na">                          ErrorMessage = &amp;quot;成人の場合、職業は必須です&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Occupation</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsMinor</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="na">[DateRange(&amp;quot;1900-01-01&amp;quot;, &amp;quot;Today&amp;quot;, ErrorMessage = &amp;quot;生年月日は1900年以降、今日以前である必要があります&amp;quot;)]</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">BirthDate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-">演習3: 上級レベル - 動的プロキシとインターセプター</h3>
<p><strong>問題</strong>: メソッド呼び出しをインターセプトし、ログ出力、キャッシュ、実行時間測定を行う動的プロキシシステムを実装してください：</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IBusinessService</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetData</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">SaveData</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetAllData</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BusinessService</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IBusinessService</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetData</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"> </span><span class="c1">// データベースアクセスのシミュレート</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Data</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ID</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">id</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SaveData</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">data</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Saved</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">id</span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">data</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetAllData</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Data1</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Data2</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Data3</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// TODO: 以下を実装してください</span>

<span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IInterceptor</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">BeforeMethod</span><span class="p">(</span><span class="n">MethodInfo</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">);</span>
<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">AfterMethod</span><span class="p">(</span><span class="n">MethodInfo</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
<span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">OnException</span><span class="p">(</span><span class="n">MethodInfo</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">exception</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LoggingInterceptor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IInterceptor</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO: ログ出力インターセプター</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CachingInterceptor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IInterceptor</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO: キャッシュインターセプター</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PerformanceInterceptor</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IInterceptor</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// TODO: パフォーマンス測定インターセプター</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ProxyFactory</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">CreateProxy</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">T</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="k">params</span><span class="w"> </span><span class="n">IInterceptor</span><span class="p">[]</span><span class="w"> </span><span class="n">interceptors</span><span class="p">)</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">class</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// TODO: 動的プロキシの作成</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>使用例</strong>:
<div class="highlight"><pre><span></span><code><span class="kt">var</span><span class="w"> </span><span class="n">service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BusinessService</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProxyFactory</span><span class="p">.</span><span class="n">CreateProxy</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">IBusinessService</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">service</span><span class="p">,</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="nf">LoggingInterceptor</span><span class="p">(),</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="nf">CachingInterceptor</span><span class="p">(),</span>
<span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="nf">PerformanceInterceptor</span><span class="p">());</span>

<span class="c1">// メソッド呼び出し時に自動的にインターセプトされる</span>
<span class="kt">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">proxy</span><span class="p">.</span><span class="n">GetData</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// ログ + キャッシュ + パフォーマンス測定</span>
</code></pre></div></p>
<h3 id="4-">演習4: 最上級レベル - 式木を使用した高速プロパティアクセサー</h3>
<p><strong>問題</strong>: 式木（Expression Tree）を使用して、リフレクションよりも高速なプロパティアクセサーを実装してください：</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">FastPropertyAccessor</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Delegate</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_getterCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Delegate</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_setterCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// TODO: 式木を使用した高速getter/setterの生成</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetGetter</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Action</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">GetSetter</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// TODO: パフォーマンス比較機能</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">BenchmarkPropertyAccess</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">T</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iterations</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// リフレクション vs 式木のパフォーマンス比較</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotImplementedException</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>要求仕様</strong>:
- 式木を使用してプロパティアクセサーを動的生成
- キャッシュ機能でコンパイル済みデリゲートを再利用
- リフレクションとのパフォーマンス比較
- ネストしたプロパティアクセス（&quot;Address.City&quot;など）への対応
- エラーハンドリング（存在しないプロパティ、型の不一致）</p>
<h2 id="6">6. パフォーマンスとセキュリティの考慮事項</h2>
<h3 id="_12">パフォーマンス最適化</h3>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ReflectionPerformanceOptimizer</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// キャッシュによる最適化</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">PropertyInfo</span><span class="p">[]</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_propertyCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Type</span><span class="p">,</span><span class="w"> </span><span class="n">MethodInfo</span><span class="p">[]</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_methodCache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentDictionary</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Delegate</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_compiledAccessors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">();</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DemonstrateOptimizations</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">===</span><span class="w"> </span><span class="err">リフレクション最適化技法</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// 1. キャッシュの効果</span>
<span class="w">        </span><span class="n">DemonstrateCaching</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 2. 式木コンパイルの効果</span>
<span class="w">        </span><span class="n">DemonstrateExpressionCompilation</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 3. 最適化手法の比較</span>
<span class="w">        </span><span class="n">ComparePerformance</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DemonstrateCaching</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">キャッシュ最適化</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10000</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Employee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テスト</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">部署</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// キャッシュなし</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stopwatch</span><span class="p">.</span><span class="n">StartNew</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">iterations</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">).</span><span class="n">GetProperties</span><span class="p">();</span><span class="w"> </span><span class="c1">// 毎回取得</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">キャッシュなし</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">}</span><span class="n">ms</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// キャッシュあり</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">iterations</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetCachedProperties</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">キャッシュあり</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">}</span><span class="n">ms</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">PropertyInfo</span><span class="p">[]</span><span class="w"> </span><span class="nf">GetCachedProperties</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_propertyCache</span><span class="p">.</span><span class="n">GetOrAdd</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">GetProperties</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DemonstrateExpressionCompilation</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">式木コンパイル最適化</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100000</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Employee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テスト</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">部署</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">nameProperty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">).</span><span class="n">GetProperty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Name</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// 通常のリフレクション</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stopwatch</span><span class="p">.</span><span class="n">StartNew</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">iterations</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nameProperty</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">リフレクション</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">}</span><span class="n">ms</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// コンパイル済みアクセサー</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">getter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreatePropertyGetter</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Employee</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Name</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">iterations</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getter</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">コンパイル済み</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">}</span><span class="n">ms</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// 直接アクセス（参考）</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Restart</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="n">iterations</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">employee</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">直接アクセス</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">}</span><span class="n">ms</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">CreatePropertyGetter</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">cacheKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;{</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">FullName</span><span class="p">}.{</span><span class="n">propertyName</span><span class="p">}.</span><span class="n">Get</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;)</span><span class="n">_compiledAccessors</span><span class="p">.</span><span class="n">GetOrAdd</span><span class="p">(</span><span class="n">cacheKey</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Parameter</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">obj</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Property</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span><span class="w"> </span><span class="n">propertyName</span><span class="p">);</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Expression</span><span class="p">.</span><span class="n">Lambda</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Func</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">TProperty</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;(</span><span class="n">property</span><span class="p">,</span><span class="w"> </span><span class="n">parameter</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">lambda</span><span class="p">.</span><span class="n">Compile</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ComparePerformance</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">総合パフォ</span><span class="n">ー</span><span class="err">マンス比較</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">testCases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">プロパティ取得</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="p">(</span><span class="n">Action</span><span class="p">)(()</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">TestPropertyGetting</span><span class="p">())),</span>
<span class="w">            </span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">メソッド呼び出し</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="p">(</span><span class="n">Action</span><span class="p">)(()</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">TestMethodInvocation</span><span class="p">())),</span>
<span class="w">            </span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">オブジェクト生成</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="p">(</span><span class="n">Action</span><span class="p">)(()</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">TestObjectCreation</span><span class="p">()))</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">action</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">testCases</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="p">{</span><span class="n">name</span><span class="p">}:</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">            </span><span class="n">MeasurePerformance</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TestPropertyGetting</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Employee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テスト</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">部署</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">).</span><span class="n">GetProperty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Name</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// 複数回のプロパティアクセス</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TestMethodInvocation</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">employee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Employee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テスト</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">部署</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">GetEmployeeInfo</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">employee</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TestObjectCreation</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">).</span><span class="n">GetConstructor</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">});</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kt">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">constructor</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テスト</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">部署</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">MeasurePerformance</span><span class="p">(</span><span class="n">Action</span><span class="w"> </span><span class="n">action</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ウォームアップ</span>
<span class="w">        </span><span class="n">action</span><span class="p">();</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">sw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stopwatch</span><span class="p">.</span><span class="n">StartNew</span><span class="p">();</span>
<span class="w">        </span><span class="n">action</span><span class="p">();</span>
<span class="w">        </span><span class="n">sw</span><span class="p">.</span><span class="n">Stop</span><span class="p">();</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">実行時間</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">sw</span><span class="p">.</span><span class="n">ElapsedMilliseconds</span><span class="p">}</span><span class="n">ms</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_13">セキュリティ考慮事項</h3>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ReflectionSecurityManager</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// 許可されたアセンブリのリスト</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_allowedAssemblies</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 許可されたメソッドのパターン</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_allowedMethodPatterns</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 禁止されたタイプ</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Type</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">_forbiddenTypes</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">ReflectionSecurityManager</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_allowedAssemblies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">System</span><span class="p">.</span><span class="n">Private</span><span class="p">.</span><span class="n">CoreLib</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">MyApplication</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="c1">// 自分のアプリケーション</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">MyApplication</span><span class="p">.</span><span class="n">Domain</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="n">_allowedMethodPatterns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">string</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Get</span><span class="o">*&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Set</span><span class="o">*&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">ToString</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Equals</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">GetHashCode</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="n">_forbiddenTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Type</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">),</span>
<span class="w">            </span><span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="p">.</span><span class="n">Process</span><span class="p">),</span>
<span class="w">            </span><span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Assembly</span><span class="p">)</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DemonstrateSecurityChecks</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">===</span><span class="w"> </span><span class="err">リフレクションセキュリティチェック</span><span class="w"> </span><span class="o">===&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="c1">// 安全なタイプアクセス</span>
<span class="w">        </span><span class="n">TestSafeTypeAccess</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// 危険なメソッド呼び出しの防止</span>
<span class="w">        </span><span class="n">TestDangerousMethodPrevention</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// アセンブリ制限</span>
<span class="w">        </span><span class="n">TestAssemblyRestriction</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TestSafeTypeAccess</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">安全なタイプアクセス</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">safeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">);</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">dangerousType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">);</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Employee</span><span class="err">型のアクセス</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">IsTypeAccessAllowed</span><span class="p">(</span><span class="n">safeType</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">File</span><span class="err">型のアクセス</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">IsTypeAccessAllowed</span><span class="p">(</span><span class="n">dangerousType</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TestDangerousMethodPrevention</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">危険なメソッド呼び出しの防止</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="k">try</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 安全なメソッド</span>
<span class="w">            </span><span class="n">InvokeMethodSafely</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">GetEmployeeInfo</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Employee</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">テスト</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">部署</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;),</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// 危険なメソッド（実際には呼び出されない）</span>
<span class="w">            </span><span class="n">InvokeMethodSafely</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Delete</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">somefile</span><span class="p">.</span><span class="n">txt</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SecurityException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">セキュリティ例外</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TestAssemblyRestriction</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">\</span><span class="n">n</span><span class="o">---</span><span class="w"> </span><span class="err">アセンブリ制限</span><span class="w"> </span><span class="o">---&amp;</span><span class="n">quot</span><span class="p">;);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">currentAssembly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Employee</span><span class="p">).</span><span class="n">Assembly</span><span class="p">;</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">systemAssembly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">).</span><span class="n">Assembly</span><span class="p">;</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">アプリケ</span><span class="n">ー</span><span class="err">ションアセンブリ</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">IsAssemblyAllowed</span><span class="p">(</span><span class="n">currentAssembly</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">システムアセンブリ</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">IsAssemblyAllowed</span><span class="p">(</span><span class="n">systemAssembly</span><span class="p">)}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsTypeAccessAllowed</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 禁止タイプのチェック</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_forbiddenTypes</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// アセンブリのチェック</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsAssemblyAllowed</span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="n">Assembly</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 危険な名前空間のチェック</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">dangerousNamespaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">System</span><span class="p">.</span><span class="n">Diagnostics</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dangerousNamespaces</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">Namespace</span><span class="o">?.</span><span class="n">StartsWith</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">true</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsAssemblyAllowed</span><span class="p">(</span><span class="n">Assembly</span><span class="w"> </span><span class="n">assembly</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">assemblyName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assembly</span><span class="p">.</span><span class="n">GetName</span><span class="p">().</span><span class="n">Name</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 許可リストにあるか確認</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">_allowedAssemblies</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">assemblyName</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// アプリケーション固有のアセンブリは許可</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">assemblyName</span><span class="o">?.</span><span class="n">StartsWith</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">MyApplication</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">true</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="nf">InvokeMethodSafely</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">methodName</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">parameters</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// タイプアクセスチェック</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsTypeAccessAllowed</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">SecurityException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">タイプ</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="err">へのアクセスは許可されていません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// メソッド名パターンチェック</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsMethodNameAllowed</span><span class="p">(</span><span class="n">methodName</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">SecurityException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">メソッド</span><span class="w"> </span><span class="p">{</span><span class="n">methodName</span><span class="p">}</span><span class="w"> </span><span class="err">の実行は許可されていません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">(</span><span class="n">methodName</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">MethodAccessException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">メソッド</span><span class="w"> </span><span class="p">{</span><span class="n">methodName</span><span class="p">}</span><span class="w"> </span><span class="err">が見つかりません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// 追加のセキュリティチェック</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsMethodDangerous</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">SecurityException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">危険なメソッド</span><span class="w"> </span><span class="p">{</span><span class="n">methodName</span><span class="p">}</span><span class="w"> </span><span class="err">の実行は禁止されています</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">安全なメソッド実行</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">}.{</span><span class="n">methodName</span><span class="p">}</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">parameters</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsMethodNameAllowed</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">methodName</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_allowedMethodPatterns</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">pattern</span><span class="w"> </span><span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">EndsWith</span><span class="p">(</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">*&amp;</span><span class="n">quot</span><span class="p">;))</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">methodName</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="n">pattern</span><span class="p">.</span><span class="n">TrimEnd</span><span class="p">(</span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;</span><span class="o">*&amp;</span><span class="n">apos</span><span class="p">;));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">methodName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">pattern</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsMethodDangerous</span><span class="p">(</span><span class="n">MethodInfo</span><span class="w"> </span><span class="n">method</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">dangerousMethodNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Delete</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Execute</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Start</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Kill</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">Load</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;,</span>
<span class="w">            </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">LoadFrom</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span>
<span class="w">        </span><span class="p">};</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dangerousMethodNames</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 入力検証とサニタイズ</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">SanitizeInput</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">input</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">input</span><span class="p">))</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">input</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 危険な文字の除去</span>
<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">dangerousChars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;;</span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;</span><span class="err">\</span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;</span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">apos</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">ch</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">dangerousChars</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input</span><span class="p">.</span><span class="n">Replace</span><span class="p">(</span><span class="n">ch</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">input</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// プロパティアクセスの制限</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="nf">GetPropertySafely</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">propertyName</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">IsTypeAccessAllowed</span><span class="p">(</span><span class="n">type</span><span class="p">))</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">SecurityException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">タイプ</span><span class="w"> </span><span class="p">{</span><span class="n">type</span><span class="p">.</span><span class="n">Name</span><span class="p">}</span><span class="w"> </span><span class="err">へのアクセスは許可されていません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">propertyName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SanitizeInput</span><span class="p">(</span><span class="n">propertyName</span><span class="p">);</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">property</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="p">.</span><span class="n">GetProperty</span><span class="p">(</span><span class="n">propertyName</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">property</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">ArgumentException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">プロパティ</span><span class="w"> </span><span class="p">{</span><span class="n">propertyName</span><span class="p">}</span><span class="w"> </span><span class="err">が見つかりません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">property</span><span class="p">.</span><span class="n">CanRead</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="p">(</span><span class="err">$</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="err">プロパティ</span><span class="w"> </span><span class="p">{</span><span class="n">propertyName</span><span class="p">}</span><span class="w"> </span><span class="err">は読み取り専用ではありません</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">property</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="_14">まとめ</h2>
<h3 id="_15">リフレクション活用のベストプラクティス</h3>
<h4 id="_16"><strong>適切な使用場面</strong></h4>
<ol>
<li><strong>フレームワーク開発</strong>: ORM、DI、シリアライゼーション</li>
<li><strong>設定主導システム</strong>: XML/JSON設定からのオブジェクト生成</li>
<li><strong>開発ツール</strong>: デバッグ、診断、コード生成</li>
<li><strong>プラグインアーキテクチャ</strong>: 動的なモジュール読み込み</li>
<li><strong>汎用ライブラリ</strong>: バリデーション、マッピング</li>
</ol>
<h4 id="_17"><strong>パフォーマンス最適化戦略</strong></h4>
<ul>
<li><strong>キャッシュの活用</strong>: Type、PropertyInfo、MethodInfoをキャッシュ</li>
<li><strong>式木コンパイル</strong>: 繰り返し実行される処理は式木でコンパイル</li>
<li><strong>遅延初期化</strong>: Lazy&lt;T&gt;を使用した必要時のみの初期化</li>
<li><strong>並列処理</strong>: ConcurrentDictionaryによるスレッドセーフなキャッシュ</li>
</ul>
<h4 id="_18"><strong>セキュリティ考慮事項</strong></h4>
<ul>
<li><strong>アクセス制御</strong>: 許可されたアセンブリ・タイプのみ使用</li>
<li><strong>入力検証</strong>: ユーザー入力のサニタイズと検証</li>
<li><strong>最小権限の原則</strong>: 必要最小限の権限でのアクセス</li>
<li><strong>監査ログ</strong>: リフレクションによるアクセスのログ記録</li>
</ul>
<h4 id="_19"><strong>設計原則</strong></h4>
<ul>
<li><strong>型安全性の確保</strong>: 可能な限りジェネリクスを活用</li>
<li><strong>エラーハンドリング</strong>: 適切な例外処理とエラーメッセージ</li>
<li><strong>文書化</strong>: 動的な処理の仕様を明確に文書化</li>
<li><strong>テスタビリティ</strong>: モックやスタブを使用したテスト可能な設計</li>
</ul>
<h3 id="_20">次のステップへ</h3>
<p>リフレクションと動的プログラミングの技法を習得することで、より柔軟で再利用可能なシステムを構築できるようになります。これらの技術は、エンタープライズアプリケーション開発において特に重要です。</p>
<p><strong>次の学習項目</strong>:
- <strong>並行プログラミング</strong>: Task、async/await、並列コレクション
- <strong>例外処理</strong>: 構造化例外処理、カスタム例外
- <strong>メモリ管理</strong>: ガベージコレクション、IDisposable
- <strong>統合プロジェクト</strong>: 学習した技術を活用した実践的なアプリケーション開発</p>
<p>適切に使用されたリフレクションは、コードの再利用性と保守性を大幅に向上させます。継続的な学習と実践を通じて、高度な.NET開発者としてのスキルを身につけていきましょう。</content>
</lesson></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>